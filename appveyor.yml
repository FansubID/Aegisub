image: Visual Studio 2019

environment:
  WXWIN: '%APPVEYOR_BUILD_FOLDER%\wxWidgets'
  ICUWIN: '%APPVEYOR_BUILD_FOLDER%\icu'

install:
  # Set paths to dependencies (based on architecture)
  - cmd: set PYTHON_ROOT=C:\python37-x64
  # Add necessary paths to PATH variable
  - cmd: set PATH=%cd%;%PYTHON_ROOT%;%PYTHON_ROOT%\Scripts;%PATH%
  # Install meson and ninja
  - cmd: pip install ninja meson
  # download wxWidgets
  - cmd: mkdir %WXWIN%
  - cmd: chdir %WXWIN%
  - cmd: curl -L -o wxWidgets.7z https://github.com/wxWidgets/wxWidgets/releases/download/v3.1.3/wxWidgets-3.1.3.7z
  - cmd: 7z x wxWidgets.7z
  # Download ICU
  - cmd: mkdir %ICUWIN%
  - cmd: chdir %ICUWIN%
  - cmd: curl -L -o icu.zip https://github.com/unicode-org/icu/releases/download/release-65-1/icu4c-65_1-Win64-MSVC2017.zip
  - cmd: 7z x icu.zip
  # Set up the build environment
  - cmd: set BOOST_ROOT=C:\Libraries\boost_1_73_0
  - cmd: '"C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvarsall.bat" x86_amd64'
  # build wxWidgets
  - cmd: chdir %WXWIN%\build\msw
  - cmd: nmake -f makefile.vc BUILD=release COMPILER_PREFIX=vc142_x64 SHARED=1
  - cmd: nmake -f makefile.vc BUILD=release COMPILER_PREFIX=vc142_x64 SHARED=1 UNICODE=0
  - cmd: chdir %APPVEYOR_BUILD_FOLDER%

build_script:
  - cmd: meson --backend=ninja --buildtype release -Dwx_path=%WXWIN% -Dicu_path=%ICUWIN% builddir
  - cmd: ninja -C builddir

